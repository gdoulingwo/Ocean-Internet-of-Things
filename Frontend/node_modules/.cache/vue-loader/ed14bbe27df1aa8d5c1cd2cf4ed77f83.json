{"remainingRequest":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\src\\views\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\src\\views\\login.vue","mtime":1636357460455},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { encrypt } from '@/utils/rsaEncrypt'\r\nimport Config from '@/settings'\r\nimport { getCodeImg } from '@/api/login'\r\nimport Cookies from 'js-cookie'\r\nimport Background from '@/assets/images/background.jpg'\r\nexport default {\r\n  name: 'Login',\r\n  data() {\r\n    return {\r\n      Background: Background,\r\n      codeUrl: '',\r\n      cookiePass: '',\r\n      loginForm: {\r\n        username: 'admin',\r\n        password: '123456',\r\n        rememberMe: false,\r\n        code: '',\r\n        uuid: ''\r\n      },\r\n      loginRules: {\r\n        username: [{ required: true, trigger: 'blur', message: '用户名不能为空' }],\r\n        password: [{ required: true, trigger: 'blur', message: '密码不能为空' }],\r\n        code: [{ required: true, trigger: 'change', message: '验证码不能为空' }]\r\n      },\r\n      loading: false,\r\n      redirect: undefined\r\n    }\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler: function(route) {\r\n        this.redirect = route.query && route.query.redirect\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n  created() {\r\n    // 获取验证码\r\n    this.getCode()\r\n    // 获取用户名密码等Cookie\r\n    this.getCookie()\r\n    // token 过期提示\r\n    this.point()\r\n  },\r\n  methods: {\r\n    getCode() {\r\n      getCodeImg().then(res => {\r\n        this.codeUrl = res.img\r\n        this.loginForm.uuid = res.uuid\r\n      })\r\n    },\r\n    getCookie() {\r\n      const username = Cookies.get('username')\r\n      let password = Cookies.get('password')\r\n      const rememberMe = Cookies.get('rememberMe')\r\n      // 保存cookie里面的加密后的密码\r\n      this.cookiePass = password === undefined ? '' : password\r\n      password = password === undefined ? this.loginForm.password : password\r\n      this.loginForm = {\r\n        username: username === undefined ? this.loginForm.username : username,\r\n        password: password,\r\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\r\n        code: ''\r\n      }\r\n    },\r\n    handleLogin() {\r\n      this.$refs.loginForm.validate(valid => {\r\n        const user = {\r\n          username: this.loginForm.username,\r\n          password: this.loginForm.password,\r\n          rememberMe: this.loginForm.rememberMe,\r\n          code: this.loginForm.code,\r\n          uuid: this.loginForm.uuid\r\n        }\r\n        if (user.password !== this.cookiePass) {\r\n          user.password = encrypt(user.password)\r\n        }\r\n        if (valid) {\r\n          this.loading = true\r\n          if (user.rememberMe) {\r\n            Cookies.set('username', user.username, { expires: Config.passCookieExpires })\r\n            Cookies.set('password', user.password, { expires: Config.passCookieExpires })\r\n            Cookies.set('rememberMe', user.rememberMe, { expires: Config.passCookieExpires })\r\n          } else {\r\n            Cookies.remove('username')\r\n            Cookies.remove('password')\r\n            Cookies.remove('rememberMe')\r\n          }\r\n          this.$store.dispatch('Login', user).then(() => {\r\n            this.loading = false\r\n            this.$router.push({ path: this.redirect || '/' })\r\n          }).catch(() => {\r\n            this.loading = false\r\n            this.getCode()\r\n          })\r\n        } else {\r\n          console.log('error submit!!')\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    point() {\r\n      const point = Cookies.get('point') !== undefined\r\n      if (point) {\r\n        this.$notify({\r\n          title: '提示',\r\n          message: '当前登录状态已过期，请重新登录！',\r\n          type: 'warning',\r\n          duration: 5000\r\n        })\r\n        Cookies.remove('point')\r\n      }\r\n    }\r\n  }\r\n}\r\n",null]}