{"remainingRequest":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\src\\views\\system\\menu\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\src\\views\\system\\menu\\index.vue","mtime":1636357460522},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\untitled\\Ocean-Internet-of-Things\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport crudMenu from '@/api/system/menu'\r\nimport IconSelect from '@/components/IconSelect'\r\nimport Treeselect from '@riophae/vue-treeselect'\r\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\r\nimport { LOAD_CHILDREN_OPTIONS } from '@riophae/vue-treeselect'\r\nimport CRUD, { presenter, header, form, crud } from '@crud/crud'\r\nimport rrOperation from '@crud/RR.operation'\r\nimport crudOperation from '@crud/CRUD.operation'\r\nimport udOperation from '@crud/UD.operation'\r\nimport DateRangePicker from '@/components/DateRangePicker'\r\n\r\n// crud交由presenter持有\r\nconst defaultForm = { id: null, title: null, menuSort: 999, path: null, component: null, componentName: null, iframe: false, roles: [], pid: 0, icon: null, cache: false, hidden: false, type: 0, permission: null }\r\nexport default {\r\n  name: 'Menu',\r\n  components: { Treeselect, IconSelect, crudOperation, rrOperation, udOperation, DateRangePicker },\r\n  cruds() {\r\n    return CRUD({ title: '菜单', url: 'api/menus', crudMethod: { ...crudMenu }})\r\n  },\r\n  mixins: [presenter(), header(), form(defaultForm), crud()],\r\n  data() {\r\n    return {\r\n      menus: [],\r\n      permission: {\r\n        add: ['admin', 'menu:add'],\r\n        edit: ['admin', 'menu:edit'],\r\n        del: ['admin', 'menu:del']\r\n      },\r\n      rules: {\r\n        title: [\r\n          { required: true, message: '请输入标题', trigger: 'blur' }\r\n        ],\r\n        path: [\r\n          { required: true, message: '请输入地址', trigger: 'blur' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // 新增与编辑前做的操作\r\n    [CRUD.HOOK.afterToCU](crud, form) {\r\n      this.menus = []\r\n      if (form.id != null) {\r\n        if (form.pid === null) {\r\n          form.pid = 0\r\n        }\r\n        this.getSupDepts(form.id)\r\n      } else {\r\n        this.menus.push({ id: 0, label: '顶级类目', children: null })\r\n      }\r\n    },\r\n    getMenus(tree, treeNode, resolve) {\r\n      const params = { pid: tree.id }\r\n      setTimeout(() => {\r\n        crudMenu.getMenus(params).then(res => {\r\n          resolve(res.content)\r\n        })\r\n      }, 100)\r\n    },\r\n    getSupDepts(id) {\r\n      crudMenu.getMenuSuperior(id).then(res => {\r\n        const children = res.map(function(obj) {\r\n          if (!obj.leaf && !obj.children) {\r\n            obj.children = null\r\n          }\r\n          return obj\r\n        })\r\n        this.menus = [{ id: 0, label: '顶级类目', children: children }]\r\n      })\r\n    },\r\n    loadMenus({ action, parentNode, callback }) {\r\n      if (action === LOAD_CHILDREN_OPTIONS) {\r\n        crudMenu.getMenusTree(parentNode.id).then(res => {\r\n          parentNode.children = res.map(function(obj) {\r\n            if (!obj.leaf) {\r\n              obj.children = null\r\n            }\r\n            return obj\r\n          })\r\n          setTimeout(() => {\r\n            callback()\r\n          }, 100)\r\n        })\r\n      }\r\n    },\r\n    // 选中图标\r\n    selected(name) {\r\n      this.form.icon = name\r\n    }\r\n  }\r\n}\r\n",null]}